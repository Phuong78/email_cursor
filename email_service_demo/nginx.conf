server {
    # Nginx sẽ lắng nghe ở port 8080, là cổng mà React UI sẽ gọi đến
    listen 8080;
    server_name localhost;

    # Đối với mọi request đi vào
    location / {
        # Luôn luôn thêm các header CORS để cho phép request từ React UI
        # Đây là phần quan trọng nhất để sửa lỗi
        add_header 'Access-Control-Allow-Origin' 'http://localhost:3000' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type' always;

        # Nếu là request OPTIONS (trình duyệt gửi trước để kiểm tra CORS), trả về 204 ngay lập tức
        if ($request_method = 'OPTIONS') {
            return 204;
        }

        # Chuyển tiếp tất cả các request khác đến Jenkins
        # 'jenkins' là tên service trong docker-compose, nó sẽ tự tìm đến container Jenkins
        proxy_pass http://jenkins:8080; 
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}